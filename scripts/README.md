# SQL Scripts для Service Desk

Этот каталог содержит SQL скрипты для настройки и обновления базы данных.

## Порядок выполнения скриптов

### Первоначальная настройка

1. **001_create_tables.sql** - Создание всех таблиц базы данных
2. **002_enable_rls.sql** - Включение Row Level Security (устарел, используйте 009)
3. **003_seed_data.sql** - Начальные данные (SLA, категории, компания)
4. **004_user_profile_trigger.sql** - Триггер для автоматического создания профиля пользователя

### Исправления RLS политик

5. **005_fix_users_rls.sql** - Первая версия исправления RLS (частично)
6. **007_fix_rls_final.sql** - Попытка полного исправления (не используйте)
7. **008_fix_rls_cascade.sql** - Версия с CASCADE (не используйте)
8. **009_fix_users_rls_only.sql** - ✅ Правильное исправление RLS для users
9. **010_add_users_read_policy.sql** - ✅ Добавление политики чтения users

### Дополнительные функции

10. **011_add_kb_articles_rls.sql** - RLS политики для базы знаний
11. **012_add_test_engineers.sql** - ✅ Добавление тестовых инженеров и супервизоров

## Рекомендуемая последовательность для нового проекта

\`\`\`sql
-- Шаг 1: Создание структуры
\i 001_create_tables.sql
\i 004_user_profile_trigger.sql

-- Шаг 2: Настройка безопасности
\i 009_fix_users_rls_only.sql
\i 010_add_users_read_policy.sql
\i 011_add_kb_articles_rls.sql

-- Шаг 3: Начальные данные
\i 003_seed_data.sql
\i 012_add_test_engineers.sql
\`\`\`

## Как выполнить скрипты в Supabase

1. Откройте ваш проект Supabase
2. Перейдите в раздел **SQL Editor**
3. Создайте новый запрос
4. Скопируйте содержимое нужного скрипта
5. Нажмите **Run** для выполнения

## Примечания

- Скрипты 002, 005, 007, 008 оставлены для истории, но не рекомендуются к использованию
- Всегда выполняйте резервное копирование перед запуском скриптов на production
- Скрипт 012 безопасен для повторного выполнения (использует `ON CONFLICT DO NOTHING`)
